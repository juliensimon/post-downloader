<!DOCTYPE html>

<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><title>Test drive: Amazon Machine Learning + Redshift</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<section class="e-content" data-field="body">
<section class="section"><div><hr/></div><div><div><h3 id="56b8">Test drive: Amazon Machine Learning + Redshift</h3><figure id="3e1a"><img class="graf-image" src="image06.webp"/></figure><p id="87de">Last week, AWS launched their flavor of “Machine Learning as a service”, aka <a href="https://aws.amazon.com/fr/machine-learning/" target="_blank">Amazon Machine Learning</a>. It was not a moment too soon, given the number of existing cloud-based ML propositions. To name just a few: BigML, Qubole and yes, Azure Machine Learning (pretty impressive, I’m sorry to admit). So, here it is finally. Let’s take it for a ride.</p><p id="9e3e">First things first: some data is needed. Time to use a little Java program that I wrote to pump out test data simulating an e-commerce web log (see <em class="markup--p-em">Generator.java </em>in <a href="https://github.com/juliensimon/DataStuff" target="_blank">https://github.com/juliensimon/DataStuff</a>).</p><p id="9ffd">Here’s the format, columns are pretty self-explanatory: Nothing fancy, but it should do the trick. Next step: connect to my super fancy 1-node Redshift cluster and create an appropriate table for this data:</p><p id="098c">Next, let’s generate 10,000,000 lines, write them in a CSV file and upload it to my favorite S3 bucket located in <em class="markup--p-em">eu-west-1</em>. And now the AWS fun begins! Right now, Amazon ML is only available in <em class="markup--p-em">us-east-1</em>, which means that your Redshift cluster must be in the same region, as well as the S3 bucket used to output files (as I later found out). Bottom line: if everything is in <em class="markup--p-em">us-east-1</em> for now, your life will be easier ;)</p><p id="0574">Lucky me, the only cross-region operation allowed in this scenario is copying data from S3 to Redshift, here’s how: For the record, this took just under a minute for 450MB. That’s about 100MB per second sustained. Not bad :)</p><figure id="3832"><img class="graf-image" src="image11.webp"/></figure><p id="ec3f">Let’s take a quick look: <strong class="markup--p-strong">SELECT * FROM mydata LIMIT 10;</strong></p><figure id="ff9f"><img class="graf-image" src="image14.webp"/></figure><p id="0272">Looks good. Time to fire up Amazon ML. The process is quite simple:</p><ol class="postList"><li id="c41d">Create a datasource, either from an S3 file of from Redshift</li><li id="1c5f">Pick the column you want to predict the value for (in our case, we’ll use ‘<em class="markup--li-em">basket</em>’)</li><li id="8240">Send some data to build and evaluate the model (we’ll use the 10M-line file)</li><li id="529c">If the model is good enough, use it to predict values for new data</li></ol><p id="744b">Creating the datasource from Redshift is straightforward: cluster id, credentials, table name, SQL statement to build the test data.</p><figure id="772f"><img class="graf-image" src="image12.webp"/></figure><p id="a3c8">Once connected to Redshift, Amazon ML figures out the schema and data types:</p><figure id="906e"><img class="graf-image" src="image03.webp"/></figure><p id="5012">Now, let’s select our target column (the one we want to predict):</p><figure id="a888"><img class="graf-image" src="image02.webp"/></figure><p id="e99a">Next, we can customize the model. Since this is a numerical value, Amazon ML will use a numerical regression algorithm. If we had picked a boolean value, a different algorithm would have been used. Keep on eye on this in future releases, I’m sure AWS will add more algos and allow users to tweak them much more than today. As you can see, 70% of data is used to build the model, 30% to evaluate it.</p><figure id="9796"><img class="graf-image" src="image07.webp"/></figure><p id="f458">Next, Amazon ML ingests the data: In our case, this means 10 million lines, which takes a little while. You can see the different tasks: splitting the data, building the model, evaluating it.</p><figure id="198a"><img class="graf-image" src="image13.webp"/></figure><p id="84e7">A few coffees later, all tasks are completed. The longest one was by far building the ML model. The whole process lasted just under a hour (reminder: 10 columns, 10 millions lines).</p><figure id="0d43"><img class="graf-image" src="image04.webp"/></figure><p id="b7d2">So, is this model any good? Amazon ML gives limited information for now, but here it is:</p><figure id="7bca"><img class="graf-image" src="image05.webp"/></figure><p id="fba3">That promising “<em class="markup--p-em">Explore the model performance</em>” button displays a distribution curve of residuals for the part of the data set used to evaluate the model. Nothing extraordinary.</p><p id="3fdf">As a sidenote, I think it’s pretty interesting to see that a model can be build from totally random data. What does this say about the Java random generator? I’m not sure.</p><p id="48a9">Now, we’re ready to predict! Amazon ML supports batch prediction and real-time prediction through an API. I’ll use batch for now. Using a second data set of 10,000 lines missing the ‘<em class="markup--p-em">basket</em>’ column, let’s build a second data source (from S3 this time):</p><figure id="be04"><img class="graf-image" src="image01.webp"/></figure><p id="5b35">Two news tasks are created: ingest the data from S3 and predict. After a 3–4 minutes, prediction is complete:</p><figure id="1de5"><img class="graf-image" src="image09.webp"/></figure><p id="cf7a">A nice distribution curve of predicted values is also available.</p><figure id="cc4c"><img class="graf-image" src="image10.webp"/></figure><p id="69d5">Actual predicted values are available in a gzip’ed text file in S3: Pretty cool… but one last question needs to be answered. How much does it cost? Well, I did push the envelope all afternoon and so…</p><figure id="a387"><img class="graf-image" src="image08.webp"/></figure><p id="e66d">Over a thousand bucks. Ouch! Expensive fun indeed. I guess I’ll expense that one :D</p><p id="f2dc">One thousand predictions cost $0.1. So, the scenario I described (model building plus 10K predictions) only costs a few dollars (thanks Jamie <a href="https://twitter.com/ideasasylum" target="_blank">@ideasasylum</a> for pointing it out).</p><p id="6b92">However, if you decide to use live prediction on a high-traffic website or if you want to go crazy on data-mining, costs will rise VERY quickly. Caveat emptor. AWS has an history of adapting prices pretty quickly, let’s see what happens. Final words? Amazon ML delivers prediction at scale. Ease of use and documentation are what you’d expect from AWS. Features are pretty limited and the UI is still pretty rough but good things come to those who wait, I guess. Cost rises quickly, so make sure you set and track ROI targets on your ML scenarios. Easier said than done… and that’s another story :) Till next time, keep crunchin’!</p><p id="a080"><em class="markup--p-em">(Update: want to learn about real-time prediction with Amazon ML? </em><a href="http://juliensimon.blogspot.fr/2015/04/test-drive-real-time-prediction-with.html" target="_blank"><em class="markup--p-em">Read on!</em></a><em class="markup--p-em">)</em></p></div></div></section><section class="section"><div><hr/></div><div><div><p id="de0a"><em class="markup--p-em">Originally published at </em><a href="http://blog.julien.org/2015/04/test-drive-aws-machine-learning-redshift.html" target="_blank"><em class="markup--p-em">blog.julien.org</em></a><em class="markup--p-em"> on April 14, 2015.</em></p></div></div></section>
</section>
</article></body></html>