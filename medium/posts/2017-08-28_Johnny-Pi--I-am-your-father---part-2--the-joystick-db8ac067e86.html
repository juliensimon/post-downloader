<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Johnny Pi, I am your father — part 2: the joystick</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Johnny Pi, I am your father — part 2: the joystick</h1>
</header>
<section data-field="subtitle" class="p-summary">
In the previous post, we laid the foundations for movement, thanks to simple messages sent to our robot through AWS IoT.
</section>
<section data-field="body" class="e-content">
<section name="12b9" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="426e" id="426e" class="graf graf--h3 graf--leading graf--title">Johnny Pi, I am your father — part 2: the joystick</h3><p name="9488" id="9488" class="graf graf--p graf-after--h3">In the <a href="https://becominghuman.ai/johnny-pi-i-am-your-father-part-1-moving-around-e09fe95bbfce" data-href="https://becominghuman.ai/johnny-pi-i-am-your-father-part-1-moving-around-e09fe95bbfce" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">previous post</a>, we laid the foundations for movement, thanks to simple messages sent to our robot through AWS IoT.</p><p name="a864" id="a864" class="graf graf--p graf-after--p">In this post, I’ll show you how to control the robot with a joystick connected to an Arduino Yùn. I simply *love* this small device, as it is actually powered by two CPUs:</p><ul class="postList"><li name="f188" id="f188" class="graf graf--li graf-after--p">An Atheros CPU able to support a basic Linux distribution like OpenWRT. This is were the AWS IoT SDK will run.</li><li name="23c9" id="23c9" class="graf graf--li graf-after--li">An ATmega32 CPU running the Arduino code and connected to multiple analog and digital ports.</li></ul><p name="ba9a" id="ba9a" class="graf graf--p graf-after--li">Both CPUs are connected by a serial bridge, allowing the Arduino code to transparently invoke Linux APIs. The best of both worlds :) Very clever design!</p><figure name="6dff" id="6dff" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4jO6A0Jvd_wqEZR1uJJA2Q.png" data-width="1820" data-height="948" src="https://cdn-images-1.medium.com/max/800/1*4jO6A0Jvd_wqEZR1uJJA2Q.png"></figure><h4 name="a87e" id="a87e" class="graf graf--h4 graf-after--figure">What we’ll need</h4><p name="b841" id="b841" class="graf graf--p graf-after--h4">Here’s the shopping list:</p><ul class="postList"><li name="dfc8" id="dfc8" class="graf graf--li graf-after--p">an Arduino Yùn. I strongly suggest that you purchase one from the <a href="https://store.arduino.cc/arduino-yun" data-href="https://store.arduino.cc/arduino-yun" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">official Arduino store</a> or at a least from a reputable vendor. Believe it or not, there are plenty of counterfeits out there. I got one by accident and it didn’t work at all :-/</li><li name="d812" id="d812" class="graf graf--li graf-after--li">an Arduino joystick, similar to <a href="https://www.amazon.com/SainSmart-JoyStick-Breakout-Module-Arduino/dp/B00CO2N18A" data-href="https://www.amazon.com/SainSmart-JoyStick-Breakout-Module-Arduino/dp/B00CO2N18A" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">this one</a>. If you’re keen of playing with more sensors, I’d recommend buying a complete kit like <a href="https://www.amazon.com/SunFounder-Ultimate-Arduino-Mega2560-Mega328/dp/B017W15HT8" data-href="https://www.amazon.com/SunFounder-Ultimate-Arduino-Mega2560-Mega328/dp/B017W15HT8" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">this one</a>: I did and they’re great fun.</li></ul><div name="88d7" id="88d7" class="graf graf--mixtapeEmbed graf-after--li"><a href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" data-href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL"><strong class="markup--strong markup--mixtapeEmbed-strong">The Chatbot Conference</strong><br><em class="markup--em markup--mixtapeEmbed-em">The Chatbot Conference On September 12, Chatbot&#39;s Life, will host our first Chatbot Conference in San Francisco. The…</em>www.eventbrite.com</a><a href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b18003c9b669ed613368b9ca442f134b" data-thumbnail-img-id="0*cRrcUA6yRZCMVCbO." style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*cRrcUA6yRZCMVCbO.);"></a></div><h4 name="ac55" id="ac55" class="graf graf--h4 graf-after--mixtapeEmbed">Registering the Arduino in AWS IoT</h4><p name="f0d6" id="f0d6" class="graf graf--p graf-after--h4">Just like for our Raspberry Pi robot, we need to register the Arduino in AWS IoT, create a certificate, a key pair, etc. <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html" data-href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">The process</a> is exactly the same, so just repeat the same steps and download all credentials on your local machine.</p><h4 name="bd15" id="bd15" class="graf graf--h4 graf-after--p">Installing the AWS IoT SDK</h4><p name="7f86" id="7f86" class="graf graf--p graf-after--h4">Ditto for the <a href="https://github.com/aws/aws-iot-device-sdk-arduino-yun" data-href="https://github.com/aws/aws-iot-device-sdk-arduino-yun" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">AWS IoT SDK</a> installation. The only difference is that the installation script will install both the SDK and the credentials on the Arduino, so you do need the register the Arduino before installing the SDK. The process is a little more involved that for the Pi, but stick to the <a href="https://github.com/aws/aws-iot-device-sdk-arduino-yun#installation" data-href="https://github.com/aws/aws-iot-device-sdk-arduino-yun#installation" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">instructions</a> and you’ll be fine.</p><h4 name="431a" id="431a" class="graf graf--h4 graf-after--p">Connecting to AWS IoT</h4><p name="d64b" id="d64b" class="graf graf--p graf-after--h4">We’re now ready to fire up the <a href="https://www.arduino.cc/en/Main/Software" data-href="https://www.arduino.cc/en/Main/Software" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Arduino IDE</a>. First, let’s write <em class="markup--em markup--p-em">aws_iot_config.h</em>, where we’ll define all parameters required to connect. Obviously, you’ll need to replace <em class="markup--em markup--p-em">XXX</em> with the appropriate values, namely:</p><ul class="postList"><li name="ecd9" id="ecd9" class="graf graf--li graf-after--p">the prefix of the private key and the certificate,</li><li name="9cde" id="9cde" class="graf graf--li graf-after--li">the hostname of the IoT broker, which you’ll find either in the console or by issuing the ‘<em class="markup--em markup--li-em">aws iot describe-endpoint’</em> CLI command.</li></ul><figure name="57f7" id="57f7" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/juliensimon/12937f5842a0ccabb63e992a26d1239f.js"></script></figure><p name="a1e9" id="a1e9" class="graf graf--p graf-after--figure">Ok, now let’s take a look at the joystick and how we’ll connect it to the Arduino.</p><h4 name="1bf7" id="1bf7" class="graf graf--h4 graf-after--p">Connecting the joystick</h4><p name="573e" id="573e" class="graf graf--p graf-after--h4">The joystick has five analog pins. From top to bottom:</p><ul class="postList"><li name="f894" id="f894" class="graf graf--li graf-after--p">Vcc → connected to +5V.</li><li name="92c8" id="92c8" class="graf graf--li graf-after--li">Vertical movement → connected to A0.</li><li name="fd1a" id="fd1a" class="graf graf--li graf-after--li">Horizontal movement → connected to A1.</li><li name="c0b9" id="c0b9" class="graf graf--li graf-after--li">Selector. The joystick has a button located on the side. I found mine to be quite imprecise and I’ve decided not to use it. We’ll use an AWS IoT button instead in a future post :)</li><li name="c95f" id="c95f" class="graf graf--li graf-after--li">GND → connected to ground.</li></ul><figure name="20ae" id="20ae" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*SD6FbHFJyvReyy0TZ9ZLIw.png" data-width="424" data-height="320" src="https://cdn-images-1.medium.com/max/800/1*SD6FbHFJyvReyy0TZ9ZLIw.png"></figure><h4 name="2e8a" id="2e8a" class="graf graf--h4 graf-after--figure">Writing the Arduino code</h4><p name="1d65" id="1d65" class="graf graf--p graf-after--h4">Arduino programs have a simple structure:</p><ul class="postList"><li name="046a" id="046a" class="graf graf--li graf-after--p">a <em class="markup--em markup--li-em">setup</em>() function called once at power-on: this is where we’ll connect to AWS IoT and calibrate the joystick, i.e. read the voltage on the analog pins where the joystick is in the neutral position.</li><li name="88fa" id="88fa" class="graf graf--li graf-after--li">a <em class="markup--em markup--li-em">loop</em>() function called ‘forever’, or at least until you kill power: this is where we’ll read the voltage of the pins connected to the joystick, find out in which direction it moved, and then send the appropriate message to the <em class="markup--em markup--li-em">JohnnyPi/move</em> topic.</li></ul><p name="9d82" id="9d82" class="graf graf--p graf-after--li">Let’s get to work.</p><h4 name="5146" id="5146" class="graf graf--h4 graf-after--p">The setup() function</h4><p name="f050" id="f050" class="graf graf--p graf-after--h4">As you can see, we use the three <a href="https://github.com/aws/aws-iot-device-sdk-arduino-yun#api" data-href="https://github.com/aws/aws-iot-device-sdk-arduino-yun#api" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">APIs</a> from the AWS IoT SDK: <em class="markup--em markup--p-em">setup</em>(), <em class="markup--em markup--p-em">config</em>() and <em class="markup--em markup--p-em">connect</em>(). If all three succeed, then we’re connected to the message broker. Nothing complicated.</p><figure name="7b9d" id="7b9d" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/f974ebbe74d22677effe0df565019eda.js"></script></figure><h4 name="73f2" id="73f2" class="graf graf--h4 graf-after--figure">The loop() function</h4><p name="8425" id="8425" class="graf graf--p graf-after--h4">Here, we read the voltage on the X and Y pins, subtract the neutral voltage and figure out in which direction the joystick has moved. Then, we publish the proper message to the JohnnyPi/move MQTT topic using the <em class="markup--em markup--p-em">publish</em>() API. We use QoS 1 for guaranteed delivery.</p><figure name="e8c6" id="e8c6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/5c1605c1a883f7d9ab03743bb497082b.js"></script></figure><p name="a2f9" id="a2f9" class="graf graf--p graf-after--figure">That’s all it takes. Not a lot of code, is it? You’ll find everything on <a href="https://github.com/juliensimon/johnnypi/tree/master/part2" data-href="https://github.com/juliensimon/johnnypi/tree/master/part2" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Github</a>.</p><h4 name="30a7" id="30a7" class="graf graf--h4 graf-after--p">Demo</h4><p name="5717" id="5717" class="graf graf--p graf-after--h4">You can see the whole thing in action in the video below. The actual demo starts at 29:15.</p><figure name="fd92" id="fd92" class="graf graf--figure graf--iframe graf-after--p"><iframe src="https://www.youtube.com/embed/emDxDLI9FRw?start=1755&amp;feature=oembed&amp;start=1755" width="700" height="393" frameborder="0" scrolling="no"></iframe></figure><h4 name="d509" id="d509" class="graf graf--h4 graf-after--figure">What’s next</h4><p name="4b25" id="4b25" class="graf graf--p graf-after--h4">In the next post, I’ll take you through integration with Amazon Polly. Time for our little friend to speak!</p><p name="b23d" id="b23d" class="graf graf--p graf-after--p graf--trailing">As always, thank you for reading and for your support :)</p></div></div></section><section name="3848" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="80e6" id="80e6" class="graf graf--p graf--leading">Part 0: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" class="markup--anchor markup--p-anchor" target="_blank">a sneak preview</a></p><p name="4525" id="4525" class="graf graf--p graf-after--p">Part 1: <a href="https://becominghuman.ai/johnny-pi-i-am-your-father-part-1-moving-around-e09fe95bbfce" data-href="https://becominghuman.ai/johnny-pi-i-am-your-father-part-1-moving-around-e09fe95bbfce" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">moving around</a></p><p name="0ddf" id="0ddf" class="graf graf--p graf-after--p">Part 3: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-3-adding-cloud-based-speech-fb6e4f207c76" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-3-adding-cloud-based-speech-fb6e4f207c76" class="markup--anchor markup--p-anchor" target="_blank">adding cloud-based speech</a></p><p name="8aec" id="8aec" class="graf graf--p graf-after--p">Part 4: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-4-adding-cloud-based-vision-8830c2676113" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-4-adding-cloud-based-vision-8830c2676113" class="markup--anchor markup--p-anchor" target="_blank">cloud-based vision</a></p><p name="de3b" id="de3b" class="graf graf--p graf-after--p">Part 5: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-5-adding-mxnet-for-local-image-classification-bc27a5fd2c27" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-5-adding-mxnet-for-local-image-classification-bc27a5fd2c27" class="markup--anchor markup--p-anchor" target="_blank">local image classification with MXNet</a></p><figure name="c5f0" id="c5f0" class="graf graf--figure graf--iframe graf-after--p"><iframe src="https://upscri.be/8f5f8b?as_embed=true" width="700" height="420" frameborder="0" scrolling="no"></iframe></figure></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="db23" id="db23" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--figure" style="width: 33.333%;"><a href="https://becominghuman.ai/artificial-intelligence-communities-c305f28e674c" data-href="https://becominghuman.ai/artificial-intelligence-communities-c305f28e674c" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*2f7OqE2AJK1KSrhkmD9ZMw.png" data-width="255" data-height="170" src="https://cdn-images-1.medium.com/max/400/1*2f7OqE2AJK1KSrhkmD9ZMw.png"></a></figure><figure name="fb30" id="fb30" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><a href="https://upscri.be/8f5f8b" data-href="https://upscri.be/8f5f8b" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*v-PpfkSWHbvlWWamSVHHWg.png" data-width="255" data-height="170" src="https://cdn-images-1.medium.com/max/400/1*v-PpfkSWHbvlWWamSVHHWg.png"></a></figure><figure name="ed26" id="ed26" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure graf--trailing" style="width: 33.333%;"><a href="https://becominghuman.ai/write-for-us-48270209de63" data-href="https://becominghuman.ai/write-for-us-48270209de63" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*Wt2auqISiEAOZxJ-I7brDQ.png" data-width="255" data-height="170" src="https://cdn-images-1.medium.com/max/400/1*Wt2auqISiEAOZxJ-I7brDQ.png"></a></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@julsimon" class="p-author h-card">Julien Simon</a> on <a href="https://medium.com/p/db8ac067e86"><time class="dt-published" datetime="2017-08-28T15:18:50.615Z">August 28, 2017</time></a>.</p><p><a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-2-the-joystick-db8ac067e86" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 26, 2025.</p></footer></article></body></html>
