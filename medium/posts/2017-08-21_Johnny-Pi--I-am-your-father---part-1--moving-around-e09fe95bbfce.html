<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Johnny Pi, I am your father — part 1: moving around</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Johnny Pi, I am your father — part 1: moving around</h1>
</header>
<section data-field="subtitle" class="p-summary">
The introduction showed you the big picture, now let’s get to work. In this post, we’re going to take care of the following tasks:
</section>
<section data-field="body" class="e-content">
<section name="d4c9" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f125" id="f125" class="graf graf--h3 graf--leading graf--title">Johnny Pi, I am your father — part 1: moving around</h3><p name="3c0c" id="3c0c" class="graf graf--p graf-after--h3">The <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" class="markup--anchor markup--p-anchor" target="_blank">introduction</a> showed you the big picture, now let’s get to work. In this post, we’re going to take care of the following tasks:</p><ul class="postList"><li name="245f" id="245f" class="graf graf--li graf-after--p">connect the robot to AWS IoT,</li><li name="fe87" id="fe87" class="graf graf--li graf-after--li">implement commands to move the robot around,</li><li name="9684" id="9684" class="graf graf--li graf-after--li">implement commands to drive the ultrasonic sensor.</li></ul><figure name="3055" id="3055" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*ks0rRASkom4s4iHc2ODvgw.png" data-width="1798" data-height="936" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*ks0rRASkom4s4iHc2ODvgw.png"></figure><h4 name="19e9" id="19e9" class="graf graf--h4 graf-after--figure">What we’ll need</h4><p name="1a87" id="1a87" class="graf graf--p graf-after--h4">I’m hoping that some of you will actually build this from scratch, so here’s the shopping list for part 1:</p><ul class="postList"><li name="dbb8" id="dbb8" class="graf graf--li graf-after--p">a <a href="https://www.dexterindustries.com/gopigo3/" data-href="https://www.dexterindustries.com/gopigo3/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">GoPiGo</a> robot</li><li name="9d9d" id="9d9d" class="graf graf--li graf-after--li">a MQTT test tool. I’ve been using <a href="http://www.mqttfx.org/" data-href="http://www.mqttfx.org/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">MQTT.fx</a> for a while and I really like it (please consider making a <a href="http://mqttfx.jensd.de/index.php/donate" data-href="http://mqttfx.jensd.de/index.php/donate" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">donation</a>). It can connect to AWS IoT in exactly the same way as a device (i.e. with a certificate and a key pair).</li><li name="503c" id="503c" class="graf graf--li graf-after--li">Alternatively, you can use the MQTT client embedded in the <a href="https://docs.aws.amazon.com/iot/latest/developerguide/view-mqtt-messages.html" data-href="https://docs.aws.amazon.com/iot/latest/developerguide/view-mqtt-messages.html" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">AWS IoT console</a>.</li></ul><div name="39e8" id="39e8" class="graf graf--mixtapeEmbed graf-after--li"><a href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" data-href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL"><strong class="markup--strong markup--mixtapeEmbed-strong">The Chatbot Conference</strong><br><em class="markup--em markup--mixtapeEmbed-em">The Chatbot Conference On September 12, Chatbot&#39;s Life, will host our first Chatbot Conference in San Francisco. The…</em>www.eventbrite.com</a><a href="https://www.eventbrite.com/e/the-chatbot-conference-tickets-34868758395?aff=CBL" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b18003c9b669ed613368b9ca442f134b" data-thumbnail-img-id="0*cY-G9spX4fXoRjtu." style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*cY-G9spX4fXoRjtu.);"></a></div><h4 name="819d" id="819d" class="graf graf--h4 graf-after--mixtapeEmbed">Looking at the GoPiGo API</h4><p name="8d4c" id="8d4c" class="graf graf--p graf-after--h4">Once you’ve built your robot and connected it to WiFi, you can <em class="markup--em markup--p-em">ssh</em> to it (user:<em class="markup--em markup--p-em">pi</em>, password: <em class="markup--em markup--p-em">robots1234</em>) and run some basic commands to get familiar with the GoPiGo <a href="https://www.dexterindustries.com/GoPiGo/programming/python-programming-for-the-raspberry-pi-gopigo/" data-href="https://www.dexterindustries.com/GoPiGo/programming/python-programming-for-the-raspberry-pi-gopigo/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Python API</a>. It really couldn’t be simpler, here’s a small example inspired by the <a href="https://en.wikipedia.org/wiki/Logo_%28programming_language%29" data-href="https://en.wikipedia.org/wiki/Logo_(programming_language)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Logo turtle</a>. Make sure you have enough space around the robot… and stay clear of stairs or any other fall hazard!</p><figure name="79a7" id="79a7" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/30d3e5b2308c9c572027e654441a46d5.js"></script></figure><p name="efe9" id="efe9" class="graf graf--p graf-after--figure">Feel free to play with the other commands. If you have connected the servo and the ultrasonic sensor, you should definitely try the associated commands as well. Once again, it’s all super simple and even Python beginners should feel comfortable very quickly.</p><h4 name="3527" id="3527" class="graf graf--h4 graf-after--p">Installing the AWS IoT SDK</h4><p name="4748" id="4748" class="graf graf--p graf-after--h4">Of course, we’re not going to run Python scripts to drive our robot. We’re going to send commands through the <a href="https://aws.amazon.com/iot/" data-href="https://aws.amazon.com/iot/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">AWS IoT</a> <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-message-broker.html" data-href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-message-broker.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">message broker</a>: more precisely, the robot is going to subscribe to MQTT <a href="https://docs.aws.amazon.com/iot/latest/developerguide/topics.html" data-href="https://docs.aws.amazon.com/iot/latest/developerguide/topics.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">topics</a> (one for robot movement, one for servo movement), where we’re going to publish simple commands like ‘left’ or ‘right’.</p><p name="2c44" id="2c44" class="graf graf--p graf-after--p">In order to communicate with the message broker, we first need to install the <a href="https://github.com/aws/aws-iot-device-sdk-python" data-href="https://github.com/aws/aws-iot-device-sdk-python" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">AWS IoT Python SDK</a>. Just <em class="markup--em markup--p-em">ssh</em> to the robot and issue this single command:</p><p name="56ec" id="56ec" class="graf graf--p graf-after--p">$ pip install AWSIoTPythonSDK</p><p name="92c9" id="92c9" class="graf graf--p graf-after--p">That’s it. Now let’s register the robot in AWS IoT.</p><h4 name="b1c6" id="b1c6" class="graf graf--h4 graf-after--p">Registering the robot in AWS IoT</h4><p name="47ff" id="47ff" class="graf graf--p graf-after--h4">In AWS IoT, a device (or “thing”, as they’re called) needs:</p><ul class="postList"><li name="fac2" id="fac2" class="graf graf--li graf-after--p">a name (how about “JohnnyPi”?),</li><li name="f749" id="f749" class="graf graf--li graf-after--li">an identity, composed of an X509 certificate (for authentication) and an RSA key pair (for communication encryption),</li><li name="7811" id="7811" class="graf graf--li graf-after--li">an IAM policy, listing the IoT APIs that the device is allowed to invoke and the topics that it’s allowed to access (we’ll need <em class="markup--em markup--li-em">JohnnyPi/move</em> and <em class="markup--em markup--li-em">JohnnyPi/scan</em> for now),</li><li name="2a36" id="2a36" class="graf graf--li graf-after--li">the root certificate of the AWS IoT message broker.</li></ul><p name="999c" id="999c" class="graf graf--p graf-after--li">For the sake of brevity, I won’t cover how to get through these steps, which are explained in full detail in the <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html" data-href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-gs.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">AWS documentation</a>.</p><p name="7362" id="7362" class="graf graf--p graf-after--p">Just a quick note on the IAM policy: in this context, it’s probably ok to use a very loose policy (iot:* and resource:*), but here’s the one you should really use.</p><figure name="21b6" id="21b6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/f920bb5f8cc4e580f40afebd16a92257.js"></script></figure><p name="511c" id="511c" class="graf graf--p graf-after--figure">Last but not least, don’t forget to copy the <strong class="markup--strong markup--p-strong">root certificate</strong>, the <strong class="markup--strong markup--p-strong">certificate</strong> and the <strong class="markup--strong markup--p-strong">private key</strong> to the robot, why not in a dedicated <em class="markup--em markup--p-em">certs</em> directory?</p><p name="f0d3" id="f0d3" class="graf graf--p graf-after--p">We will definitely need them to connect to the IoT message broker, which happens to be the topic of the next section!</p><h4 name="de9d" id="de9d" class="graf graf--h4 graf-after--p">Connecting to AWS IoT</h4><p name="5411" id="5411" class="graf graf--p graf-after--h4">First, let’s create the <em class="markup--em markup--p-em">iot_config.py</em> file and define all parameters required to connect. Obviously, you’ll need to replace <em class="markup--em markup--p-em">XXX</em> with the appropriate values, namely:</p><ul class="postList"><li name="ecd9" id="ecd9" class="graf graf--li graf-after--p">the prefix of the private key and the certificate,</li><li name="9cde" id="9cde" class="graf graf--li graf-after--li">the hostname of the IoT broker, which you’ll find either in the console or by issuing the ‘<em class="markup--em markup--li-em">aws iot describe-endpoint’</em> CLI command.</li></ul><figure name="bcd4" id="bcd4" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/juliensimon/c1161b15cab186d0c27dbc9b67ad57e3#file-iot_config-py.js"></script></figure><p name="1d2c" id="1d2c" class="graf graf--p graf-after--figure">Next, let’s write the <em class="markup--em markup--p-em">iot_connect.py</em> file, holding two simple functions: one for connection and one for disconnection. Nothing weird here, we’re just using the appropriate AWS APIs.</p><figure name="b0e3" id="b0e3" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/eb3fe91c7fcde8a3965599a943e948b1.js"></script></figure><p name="ceaa" id="ceaa" class="graf graf--p graf-after--figure">That’s all it takes. Make sure to test this before proceeding: just check that you can call the <em class="markup--em markup--p-em">connectIot()</em> function without any error and that you see a connection in the dashboard of the AWS IoT console :)</p><h4 name="d1fb" id="d1fb" class="graf graf--h4 graf-after--p">Subscribing to MQTT topics</h4><p name="c234" id="c234" class="graf graf--p graf-after--h4">Now, let’s subscribe to the two MQTT topics. We just have to call the <em class="markup--em markup--p-em">subscribe</em>() API in the AWS IoT SDK, passing:</p><ul class="postList"><li name="5228" id="5228" class="graf graf--li graf-after--p">the topic name,</li><li name="bf77" id="bf77" class="graf graf--li graf-after--li">the quality of service (QoS) we require. ‘0’ means none (messages may be lost), ‘1’ means ‘at least once delivery’ (lost message will be retransmitted and possibly received more than once). We’ll use ‘1’, because we definitely don’t want our robot to miss a command.</li><li name="3a8c" id="3a8c" class="graf graf--li graf-after--li">a callback, i.e. a function that will be executed each time a message is received. We’ll code them in the next section.</li></ul><figure name="062a" id="062a" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/juliensimon/a78386efa29a86d1d0f276c0aa457452.js"></script></figure><h4 name="c9a7" id="c9a7" class="graf graf--h4 graf-after--figure">Processing movement messages</h4><p name="f3a6" id="f3a6" class="graf graf--p graf-after--h4">Our MQTT messages will contain self-explanatory movement commands: ‘forward’, ‘backward’, ‘left’, ‘right’, ‘faster’, ‘slower’, ‘stop’. Thus, the role of the callback is simply to extract the command from the message payload and call the appropriate GoPiGo API.</p><p name="677b" id="677b" class="graf graf--p graf-after--p">Then, the callback sleeps for a second and stops the robot. This is a precaution to make sure that it won’t run out of control, fall off the stage, etc. Feel free to tweak this to your own liking.</p><figure name="0e6a" id="0e6a" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/c7b782c58c0c8f38bc5f8460a5c4b579.js"></script></figure><h4 name="536f" id="536f" class="graf graf--h4 graf-after--figure">Processing servo messages</h4><p name="c5d2" id="c5d2" class="graf graf--p graf-after--h4">Similarly, the servo callback will process simple commands:</p><ul class="postList"><li name="9b58" id="9b58" class="graf graf--li graf--startsWithSingleQuote graf-after--p">‘right’ rotates the servo 30° right,</li><li name="ab18" id="ab18" class="graf graf--li graf--startsWithSingleQuote graf-after--li">‘left’ rotates the servo 30° left,</li><li name="0da8" id="0da8" class="graf graf--li graf--startsWithSingleQuote graf-after--li">‘reset’ puts the servo in a central position,</li><li name="4b2e" id="4b2e" class="graf graf--li graf--startsWithSingleQuote graf-after--li">‘scan’ measures the distance to the object in front of the ultrasonic sensor and builds a text message. In future posts, we’ll send this message to Amazon Polly and to our Amazon Echo for additional fun ;) In case you were wondering, the ‘15’ parameter passed to <em class="markup--em markup--li-em">us_dist</em>() is the pin on which the servo is connected (by default, port A1 i.e. pin 15).</li></ul><figure name="84a5" id="84a5" class="graf graf--figure graf--iframe graf-after--li"><script src="https://gist.github.com/juliensimon/61a54d9069d5681844e06c131d3e6123.js"></script></figure><h4 name="5111" id="5111" class="graf graf--h4 graf-after--figure">Testing</h4><p name="ca30" id="ca30" class="graf graf--p graf-after--h4">Ok, that’s all the code we need for today: you can grab it on <a href="https://github.com/juliensimon/johnnypi/tree/master/part1" data-href="https://github.com/juliensimon/johnnypi/tree/master/part1" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Github</a>.</p><p name="41e0" id="41e0" class="graf graf--p graf-after--p">In order to test all of this, we need to:</p><ul class="postList"><li name="4fb1" id="4fb1" class="graf graf--li graf-after--p"><em class="markup--em markup--li-em">ssh</em> to the robot and start <em class="markup--em markup--li-em">server.py,</em></li><li name="91fb" id="91fb" class="graf graf--li graf-after--li">publish MQTT messages to the two topics, containing the commands we implemented on the robot.</li></ul><figure name="4287" id="4287" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*33ABC3eFt_XRTZYatNvS5A.png" data-width="2008" data-height="570" src="https://cdn-images-1.medium.com/max/800/1*33ABC3eFt_XRTZYatNvS5A.png"><figcaption class="imageCaption">Using MQTT.fx, send the ‘left’ command to the JohnnyPi/move topic with QoS 1</figcaption></figure><p name="e850" id="e850" class="graf graf--p graf-after--figure">Please make sure you test all commands. Check out the <em class="markup--em markup--p-em">server.py</em> output for any potential error.</p><h4 name="0c77" id="0c77" class="graf graf--h4 graf-after--p">What’s next</h4><p name="44e9" id="44e9" class="graf graf--p graf-after--h4">In the next post, we’ll continue to work on movement: I’ll show you how to drive the robot using a joystick connected to an Arduino Yùn :)</p><p name="9d6c" id="9d6c" class="graf graf--p graf-after--p graf--trailing">Until then, thank you for reading!</p></div></div></section><section name="5c32" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="9952" id="9952" class="graf graf--p graf--leading">Part 0: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-0-1eb537e5a36" class="markup--anchor markup--p-anchor" target="_blank">a sneak preview</a></p><p name="0d18" id="0d18" class="graf graf--p graf-after--p">Part 2: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-2-the-joystick-db8ac067e86" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-2-the-joystick-db8ac067e86" class="markup--anchor markup--p-anchor" target="_blank">the joystick</a></p><p name="78ee" id="78ee" class="graf graf--p graf-after--p">Part 3: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-3-adding-cloud-based-speech-fb6e4f207c76" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-3-adding-cloud-based-speech-fb6e4f207c76" class="markup--anchor markup--p-anchor" target="_blank">cloud-based speech</a></p><p name="4df2" id="4df2" class="graf graf--p graf-after--p">Part 4: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-4-adding-cloud-based-vision-8830c2676113" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-4-adding-cloud-based-vision-8830c2676113" class="markup--anchor markup--p-anchor" target="_blank">cloud-based vision</a></p><p name="de3b" id="de3b" class="graf graf--p graf-after--p graf--trailing">Part 5: <a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-5-adding-mxnet-for-local-image-classification-bc27a5fd2c27" data-href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-5-adding-mxnet-for-local-image-classification-bc27a5fd2c27" class="markup--anchor markup--p-anchor" target="_blank">local image classification with MXNet</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@julsimon" class="p-author h-card">Julien Simon</a> on <a href="https://medium.com/p/e09fe95bbfce"><time class="dt-published" datetime="2017-08-21T16:45:22.128Z">August 21, 2017</time></a>.</p><p><a href="https://medium.com/@julsimon/johnny-pi-i-am-your-father-part-1-moving-around-e09fe95bbfce" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 26, 2025.</p></footer></article></body></html>
