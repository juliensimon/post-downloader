<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Test drive: Amazon Machine Learning + Redshift</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Test drive: Amazon Machine Learning + Redshift</h1>
</header>
<section data-field="subtitle" class="p-summary">
Last week, AWS launched their flavor of “Machine Learning as a service”, aka Amazon Machine Learning. It was not a moment too soon, given…
</section>
<section data-field="body" class="e-content">
<section name="b169" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="56b8" id="56b8" class="graf graf--h3 graf--leading graf--title">Test drive: Amazon Machine Learning + Redshift</h3><figure name="3e1a" id="3e1a" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*aiYgKkoPKOZUpAO-.jpg" data-width="460" data-height="276" src="https://cdn-images-1.medium.com/max/800/0*aiYgKkoPKOZUpAO-.jpg"></figure><p name="87de" id="87de" class="graf graf--p graf-after--figure">Last week, AWS launched their flavor of “Machine Learning as a service”, aka <a href="https://aws.amazon.com/fr/machine-learning/" data-href="https://aws.amazon.com/fr/machine-learning/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Amazon Machine Learning</a>. It was not a moment too soon, given the number of existing cloud-based ML propositions. To name just a few: BigML, Qubole and yes, Azure Machine Learning (pretty impressive, I’m sorry to admit). So, here it is finally. Let’s take it for a ride.</p><p name="9e3e" id="9e3e" class="graf graf--p graf-after--p">First things first: some data is needed. Time to use a little Java program that I wrote to pump out test data simulating an e-commerce web log (see <em class="markup--em markup--p-em">Generator.java </em>in <a href="https://github.com/juliensimon/DataStuff" data-href="https://github.com/juliensimon/DataStuff" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://github.com/juliensimon/DataStuff</a>).</p><p name="9ffd" id="9ffd" class="graf graf--p graf-after--p">Here’s the format, columns are pretty self-explanatory: Nothing fancy, but it should do the trick. Next step: connect to my super fancy 1-node Redshift cluster and create an appropriate table for this data:</p><p name="098c" id="098c" class="graf graf--p graf-after--p">Next, let’s generate 10,000,000 lines, write them in a CSV file and upload it to my favorite S3 bucket located in <em class="markup--em markup--p-em">eu-west-1</em>. And now the AWS fun begins! Right now, Amazon ML is only available in <em class="markup--em markup--p-em">us-east-1</em>, which means that your Redshift cluster must be in the same region, as well as the S3 bucket used to output files (as I later found out). Bottom line: if everything is in <em class="markup--em markup--p-em">us-east-1</em> for now, your life will be easier ;)</p><p name="0574" id="0574" class="graf graf--p graf-after--p">Lucky me, the only cross-region operation allowed in this scenario is copying data from S3 to Redshift, here’s how: For the record, this took just under a minute for 450MB. That’s about 100MB per second sustained. Not bad :)</p><figure name="3832" id="3832" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*6VPrw5o5Z8N8be9J.png" data-width="1096" data-height="250" src="https://cdn-images-1.medium.com/max/800/0*6VPrw5o5Z8N8be9J.png"></figure><p name="ec3f" id="ec3f" class="graf graf--p graf-after--figure">Let’s take a quick look: <strong class="markup--strong markup--p-strong">SELECT * FROM mydata LIMIT 10;</strong></p><figure name="ff9f" id="ff9f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*djTJipH-k0f0ShkO.png" data-width="1312" data-height="394" src="https://cdn-images-1.medium.com/max/800/0*djTJipH-k0f0ShkO.png"></figure><p name="0272" id="0272" class="graf graf--p graf-after--figure">Looks good. Time to fire up Amazon ML. The process is quite simple:</p><ol class="postList"><li name="c41d" id="c41d" class="graf graf--li graf-after--p">Create a datasource, either from an S3 file of from Redshift</li><li name="1c5f" id="1c5f" class="graf graf--li graf-after--li">Pick the column you want to predict the value for (in our case, we’ll use ‘<em class="markup--em markup--li-em">basket</em>’)</li><li name="8240" id="8240" class="graf graf--li graf-after--li">Send some data to build and evaluate the model (we’ll use the 10M-line file)</li><li name="529c" id="529c" class="graf graf--li graf-after--li">If the model is good enough, use it to predict values for new data</li></ol><p name="744b" id="744b" class="graf graf--p graf-after--li">Creating the datasource from Redshift is straightforward: cluster id, credentials, table name, SQL statement to build the test data.</p><figure name="772f" id="772f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*Ci1DM6Wp3eOWq2gF.png" data-width="1600" data-height="1107" src="https://cdn-images-1.medium.com/max/800/0*Ci1DM6Wp3eOWq2gF.png"></figure><p name="a3c8" id="a3c8" class="graf graf--p graf-after--figure">Once connected to Redshift, Amazon ML figures out the schema and data types:</p><figure name="906e" id="906e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*AaJYCoajdDb9s0K7.png" data-width="1600" data-height="576" src="https://cdn-images-1.medium.com/max/800/0*AaJYCoajdDb9s0K7.png"></figure><p name="5012" id="5012" class="graf graf--p graf-after--figure">Now, let’s select our target column (the one we want to predict):</p><figure name="a888" id="a888" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*bluPvvx5t29x-qG6.png" data-width="1600" data-height="650" src="https://cdn-images-1.medium.com/max/800/0*bluPvvx5t29x-qG6.png"></figure><p name="e99a" id="e99a" class="graf graf--p graf-after--figure">Next, we can customize the model. Since this is a numerical value, Amazon ML will use a numerical regression algorithm. If we had picked a boolean value, a different algorithm would have been used. Keep on eye on this in future releases, I’m sure AWS will add more algos and allow users to tweak them much more than today. As you can see, 70% of data is used to build the model, 30% to evaluate it.</p><figure name="9796" id="9796" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*dbwIZLkn2s-gtQHP.png" data-width="1600" data-height="1203" src="https://cdn-images-1.medium.com/max/800/0*dbwIZLkn2s-gtQHP.png"></figure><p name="f458" id="f458" class="graf graf--p graf-after--figure">Next, Amazon ML ingests the data: In our case, this means 10 million lines, which takes a little while. You can see the different tasks: splitting the data, building the model, evaluating it.</p><figure name="198a" id="198a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*1nt6Q_TifgVs-zM6.png" data-width="1600" data-height="234" src="https://cdn-images-1.medium.com/max/800/0*1nt6Q_TifgVs-zM6.png"></figure><p name="84e7" id="84e7" class="graf graf--p graf-after--figure">A few coffees later, all tasks are completed. The longest one was by far building the ML model. The whole process lasted just under a hour (reminder: 10 columns, 10 millions lines).</p><figure name="0d43" id="0d43" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*MAGQWKNoNo4lsKa4.png" data-width="1600" data-height="293" src="https://cdn-images-1.medium.com/max/800/0*MAGQWKNoNo4lsKa4.png"></figure><p name="b7d2" id="b7d2" class="graf graf--p graf-after--figure">So, is this model any good? Amazon ML gives limited information for now, but here it is:</p><figure name="7bca" id="7bca" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*ilzKixXEfk4gVv3J.png" data-width="1600" data-height="410" src="https://cdn-images-1.medium.com/max/800/0*ilzKixXEfk4gVv3J.png"></figure><p name="fba3" id="fba3" class="graf graf--p graf-after--figure">That promising “<em class="markup--em markup--p-em">Explore the model performance</em>” button displays a distribution curve of residuals for the part of the data set used to evaluate the model. Nothing extraordinary.</p><p name="3fdf" id="3fdf" class="graf graf--p graf-after--p">As a sidenote, I think it’s pretty interesting to see that a model can be build from totally random data. What does this say about the Java random generator? I’m not sure.</p><p name="48a9" id="48a9" class="graf graf--p graf-after--p">Now, we’re ready to predict! Amazon ML supports batch prediction and real-time prediction through an API. I’ll use batch for now. Using a second data set of 10,000 lines missing the ‘<em class="markup--em markup--p-em">basket</em>’ column, let’s build a second data source (from S3 this time):</p><figure name="be04" id="be04" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*l8unqIsVPqm9bKLB.png" data-width="1084" data-height="976" src="https://cdn-images-1.medium.com/max/800/0*l8unqIsVPqm9bKLB.png"></figure><p name="5b35" id="5b35" class="graf graf--p graf-after--figure">Two news tasks are created: ingest the data from S3 and predict. After a 3–4 minutes, prediction is complete:</p><figure name="1de5" id="1de5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*rshbKc7HChVX0ejp.png" data-width="1600" data-height="395" src="https://cdn-images-1.medium.com/max/800/0*rshbKc7HChVX0ejp.png"></figure><p name="cf7a" id="cf7a" class="graf graf--p graf-after--figure">A nice distribution curve of predicted values is also available.</p><figure name="cc4c" id="cc4c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*lDgPzdZpge1zac_n.png" data-width="1210" data-height="1048" src="https://cdn-images-1.medium.com/max/800/0*lDgPzdZpge1zac_n.png"></figure><p name="69d5" id="69d5" class="graf graf--p graf-after--figure">Actual predicted values are available in a gzip’ed text file in S3: Pretty cool… but one last question needs to be answered. How much does it cost? Well, I did push the envelope all afternoon and so…</p><figure name="a387" id="a387" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*hKX9H76sNOGE-QjV.png" data-width="1600" data-height="720" src="https://cdn-images-1.medium.com/max/800/0*hKX9H76sNOGE-QjV.png"></figure><p name="e66d" id="e66d" class="graf graf--p graf-after--figure">Over a thousand bucks. Ouch! Expensive fun indeed. I guess I’ll expense that one :D</p><p name="f2dc" id="f2dc" class="graf graf--p graf-after--p">One thousand predictions cost $0.1. So, the scenario I described (model building plus 10K predictions) only costs a few dollars (thanks Jamie <a href="https://twitter.com/ideasasylum" data-href="https://twitter.com/ideasasylum" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">@ideasasylum</a> for pointing it out).</p><p name="6b92" id="6b92" class="graf graf--p graf-after--p">However, if you decide to use live prediction on a high-traffic website or if you want to go crazy on data-mining, costs will rise VERY quickly. Caveat emptor. AWS has an history of adapting prices pretty quickly, let’s see what happens. Final words? Amazon ML delivers prediction at scale. Ease of use and documentation are what you’d expect from AWS. Features are pretty limited and the UI is still pretty rough but good things come to those who wait, I guess. Cost rises quickly, so make sure you set and track ROI targets on your ML scenarios. Easier said than done… and that’s another story :) Till next time, keep crunchin’!</p><p name="a080" id="a080" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">(Update: want to learn about real-time prediction with Amazon ML? </em><a href="http://juliensimon.blogspot.fr/2015/04/test-drive-real-time-prediction-with.html" data-href="http://juliensimon.blogspot.fr/2015/04/test-drive-real-time-prediction-with.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">Read on!</em></a><em class="markup--em markup--p-em">)</em></p></div></div></section><section name="3c78" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="de0a" id="de0a" class="graf graf--p graf--leading graf--trailing"><em class="markup--em markup--p-em">Originally published at </em><a href="http://blog.julien.org/2015/04/test-drive-aws-machine-learning-redshift.html" data-href="http://blog.julien.org/2015/04/test-drive-aws-machine-learning-redshift.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">blog.julien.org</em></a><em class="markup--em markup--p-em"> on April 14, 2015.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@julsimon" class="p-author h-card">Julien Simon</a> on <a href="https://medium.com/p/ef9250610acf"><time class="dt-published" datetime="2015-04-14T00:00:00.000Z">April 14, 2015</time></a>.</p><p><a href="https://medium.com/@julsimon/test-drive-amazon-machine-learning-redshift-ef9250610acf" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 26, 2025.</p></footer></article></body></html>
