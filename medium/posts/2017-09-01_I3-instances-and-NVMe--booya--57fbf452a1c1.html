<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>I3 instances and NVMe: booya!</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">I3 instances and NVMe: booya!</h1>
</header>
<section data-field="subtitle" class="p-summary">
In a previous post, I used an i2.8xlarge instance (32 vCPUs, 244GB RAM, 8x800GB local SSD storage, 10Gb networking) to build FreeBSD in 17…
</section>
<section data-field="body" class="e-content">
<section name="97c6" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e4da" id="e4da" class="graf graf--h3 graf--leading graf--title">I3 instances and NVMe: booya!</h3><p name="9f2a" id="9f2a" class="graf graf--p graf-after--h3">In a <a href="https://medium.com/@julsimon/freebsd-from-cd-rom-to-cloud-1322e5591d99" data-href="https://medium.com/@julsimon/freebsd-from-cd-rom-to-cloud-1322e5591d99" class="markup--anchor markup--p-anchor" target="_blank">previous post</a>, I used an i2.8xlarge instance (32 vCPUs, 244GB RAM, 8x800GB local SSD storage, 10Gb networking) to build FreeBSD in 17 minutes. Pretty good, but in the never ending quest for performance, I decided to try again with an i3.8xlarge instance, as the I3 family is now supported by the latest <a href="https://aws.amazon.com/marketplace/pp/B01LWSWRED/" data-href="https://aws.amazon.com/marketplace/pp/B01LWSWRED/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">FreeBSD 11.1 AMI</a> released at the beginning of August. Kudos to <a href="https://twitter.com/cperciva" data-href="https://twitter.com/cperciva" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Colin Percival</a> for maintaining the FreeBSD AMIs!</p><h4 name="8c78" id="8c78" class="graf graf--h4 graf-after--p">The I3 family</h4><p name="e353" id="e353" class="graf graf--p graf-after--h4">The I3 family is more than a generation bump. Along with the FPGA instances (F1 family), they’re the first to support <strong class="markup--strong markup--p-strong">non-volatile memory express</strong> (<a href="https://en.wikipedia.org/wiki/NVM_Express" data-href="https://en.wikipedia.org/wiki/NVM_Express" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">NVMe</a>) SSD instance store volumes, which deliver a massive performance upgrade compared to traditional SSDs. Thanks to this new technology, the I3 family can deliver up to <strong class="markup--strong markup--p-strong">3.3 million IOPS</strong> at a 4 KB block and up to 16 GB/second of sequential disk throughput.</p><p name="4d7f" id="4d7f" class="graf graf--p graf-after--p">Along with a <strong class="markup--strong markup--p-strong">CPU upgrade</strong> (from <a href="https://en.wikipedia.org/wiki/Ivy_Bridge_%28microarchitecture%29" data-href="https://en.wikipedia.org/wiki/Ivy_Bridge_(microarchitecture)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Ivy Bridg</a>e to <a href="https://en.wikipedia.org/wiki/Broadwell_%28microarchitecture%29" data-href="https://en.wikipedia.org/wiki/Broadwell_(microarchitecture)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Broadwell</a>), we should definitely see a nice improvement in our build time. Let’s get to work.</p><h4 name="6f02" id="6f02" class="graf graf--h4 graf-after--p">Launching an I3 instance</h4><p name="bd75" id="bd75" class="graf graf--p graf-after--h4">We’ll start by launching an i3.16xlarge instance (64 vCPUs, 488GB RAM, 8x1900GB local NVMe storage, 20Gb networking), with the latest F<a href="https://aws.amazon.com/marketplace/pp/B01LWSWRED/" data-href="https://aws.amazon.com/marketplace/pp/B01LWSWRED/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">reeBSD 11.1 AMI</a> (<em class="markup--em markup--p-em">ami-ab56bed2</em> in eu-west-1).</p><figure name="4643" id="4643" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*B8YiSdGjx3ZuB_k-MB0S1g.png" data-width="516" data-height="612" src="https://cdn-images-1.medium.com/max/800/1*B8YiSdGjx3ZuB_k-MB0S1g.png"><figcaption class="imageCaption">I’m in love already</figcaption></figure><p name="52b3" id="52b3" class="graf graf--p graf-after--figure">A few minutes later, we can connect to the instance. Let’s take a look at the NVMe devices.</p><figure name="6db2" id="6db2" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/877aea0179a5856b783a3dba4797ca9d.js"></script></figure><h4 name="cfff" id="cfff" class="graf graf--h4 graf-after--figure">Preparing the build</h4><p name="2fe3" id="2fe3" class="graf graf--p graf-after--h4">Now, let’s create two ZFS pools with four disks each: one for <em class="markup--em markup--p-em">/usr/src</em>, one for <em class="markup--em markup--p-em">/usr/obj</em>.</p><figure name="d166" id="d166" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/2ee2798da8ed394de3dd849c613498f1.js"></script></figure><p name="4fe8" id="4fe8" class="graf graf--p graf-after--figure">OK, now let’s fetch and extract the FreeBSD distribution.</p><figure name="39de" id="39de" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/26c8ff40b9e7ae404b010b3a9576dcaa.js"></script></figure><h4 name="dbc9" id="dbc9" class="graf graf--h4 graf-after--figure">The moment of truth</h4><p name="53fa" id="53fa" class="graf graf--p graf-after--h4">Let’s build. Ready… set… go!</p><figure name="aa4d" id="aa4d" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/38780685abd77cdc2702b0bcbc31855c.js"></script></figure><p name="9a0d" id="9a0d" class="graf graf--p graf-after--figure">And the result is… <strong class="markup--strong markup--p-strong">10 minutes and 54 seconds</strong>.</p><p name="60a5" id="60a5" class="graf graf--p graf-after--p">This is a 35% speedup compared to the 17 minutes we got on the i2.8xlarge. Granted, the i3.16xlarge has more cores, but given the structure of the FreeBSD build, they’re hardly ever put to work. <a href="https://en.wikipedia.org/wiki/Amdahl%27s_law" data-href="https://en.wikipedia.org/wiki/Amdahl%27s_law" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Amdahl’s Law</a> strikes again.</p><p name="08fe" id="08fe" class="graf graf--p graf-after--p">I’m guessing that most of the improvement does come from the crazy-fast NVMe storage system. To confirm this, let’s run the same test using memory disks.</p><figure name="2d00" id="2d00" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/juliensimon/bce4acad6f6bbb0b30564485ffeffa0d.js"></script></figure><p name="f411" id="f411" class="graf graf--p graf-after--figure">No improvement at all. This leads me to think that CPU is now the bottleneck. Indeed, the quest never ends. Now, EC2 team, could be please get NVMe on the upcoming <a href="https://aws.amazon.com/about-aws/whats-new/2016/11/coming-soon-amazon-ec2-c5-instances-the-next-generation-of-compute-optimized-instances/" data-href="https://aws.amazon.com/about-aws/whats-new/2016/11/coming-soon-amazon-ec2-c5-instances-the-next-generation-of-compute-optimized-instances/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">C5</a> <a href="https://en.wikipedia.org/wiki/Skylake_%28microarchitecture%29" data-href="https://en.wikipedia.org/wiki/Skylake_(microarchitecture)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Skylake</a>-based instances? Please please please? :D</p><p name="c51c" id="c51c" class="graf graf--p graf-after--p graf--trailing">Thanks for reading and happy testing.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@julsimon" class="p-author h-card">Julien Simon</a> on <a href="https://medium.com/p/57fbf452a1c1"><time class="dt-published" datetime="2017-09-01T08:03:37.618Z">September 1, 2017</time></a>.</p><p><a href="https://medium.com/@julsimon/i3-instances-and-nvme-booya-57fbf452a1c1" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 26, 2025.</p></footer></article></body></html>